<!DOCTYPE html>
<html>
<head>
  <title>Schools</title>
  <meta charset="utf-8" />
  <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.6.2/leaflet.css" />
  <link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/yeti/bootstrap.min.css" rel="stylesheet">
  <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">
  <link href="assets/css/map-style.css" rel="stylesheet">
	<link rel="stylesheet" href="http://k4r573n.github.io/leaflet-control-osm-geocoder/Control.OSMGeocoder.css" />
	<link rel="stylesheet" href="assets/cluster/MarkerCluster.css" />
	<link rel="stylesheet" href="assets/cluster/MarkerCluster.Default.css" />
	<link rel = "stylesheet" href = "assets/search/leaflet-search.css"/>

<style type="text/css">
    html, body { 
        height:100%
    }
    #map {
        margin: 1em auto;
        height:70%;
    }
    .legend {
	text-align: left;
	line-height: 18px;
	color: #555;
	}
	.legend i {
	width: 18px;
	height: 18px;
	float: left;
	margin-right: 8px;
	opacity: 0.7;
	}
	.legend .circle {
	border-radius: 50%;
	width: 10px;
	height: 10px;
	margin-top: 8px;
	}                                                                                                                                                                                                            
</style>
</head>
<body>
  <div id="map" style="width: 100%; height: 100%"></div>
  <body>
  <div id='map-ui'>
    <h2 style="padding:15px;"></h2>
    <div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true">
      <div class="panel panel-primary">
        <div class="panel-heading" role="tab" id="schoolType">
          <h4 class="panel-title">
            <a class="collapsed" role="button" data-toggle="collapse" data-parent="#accordion" href="#collapseSocial" aria-expanded="true" aria-controls="collapseSocial">
              Schools
            </a>
          </h4>
        </div>
      </div>
    </div>
  </div>

  <script src="http://cdn.leafletjs.com/leaflet-0.6.2/leaflet.js"></script> 
  <script src="http://k4r573n.github.io/leaflet-control-osm-geocoder/Control.OSMGeocoder.js"></script>   
  <script src="data/points_rand.js"></script>
  <script src="assets/cluster/leaflet.markercluster-src.js"></script>
  <script  src = "assets/search/leaflet-search.js" > </script> 
  <script>

	
	var osmLink = '<a href="http://openstreetmap.org">OpenStreetMap</a>',
		topoLink = '<a href="http://{s}.tile.opentopomap.org">OpenTopoMap</a>',
		thunLink = '<a href="http://thunderforest.com/">Thunderforest</a>';
		
	var osmUrl = 'http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',
		osmAttrib = '&copy; ' + osmLink + ' Contributors',
		topoUrl = 'http://{s}.tile.opentopomap.org/{z}/{x}/{y}.png',
		topoAttrib = '&copy; ' + topoLink + ' Contributors',
		landUrl = 'http://{s}.tile.thunderforest.com/landscape/{z}/{x}/{y}.png',
		thunAttrib = '&copy; '+osmLink+' Contributors & '+thunLink;
		
	var osmMap = L.tileLayer(osmUrl, {attribution: osmAttrib}),
		topoMap = L.tileLayer(topoUrl, {attribution: topoAttrib}),
		landMap = L.tileLayer(landUrl, {attribution: thunAttrib});
		
	var map = L.map('map', {
	    layers: [osmMap] // only add one!
    })
    .setView([54.655078, -6.969706], 9);
    
    var baseLayers = {
	"OSM Mapnik": osmMap,
	"Topography": topoMap,
	"Landscape": landMap
	};

	L.control.layers(baseLayers).addTo(map);
	
	var osmGeocoder = new L.Control.OSMGeocoder({
            collapsed: 'true',
            position: 'topleft',
            text: 'My Area',
			});
        map.addControl(osmGeocoder);
        
	var markers = L.markerClusterGroup({ disableClusteringAtZoom: 16 });
	
	var colors = {
        "playgroup not in a school": 'brown',
        "playgroup in a school": 'orange',
        "day nursery": 'yellow',
        "prep dept": 'black',
        "Nursery": 'green',
        "Primary": 'red',
        "Secondary": 'blue',
        "Grammar": 'purple',
        "Special Schools": 'pink'
    };
	
	var points_rand = L.geoJson(points, {
		pointToLayer: function (feature, latlng) {                    
                return new L.CircleMarker(latlng, {
                    radius: 8,
                    fillColor: colors[feature.properties.SCHOOL_TYP],
                    color: colors[feature.properties.SCHOOL_TYP],
                    weight: 1,
                    opacity: 1,
                    fillOpacity: 0.8,
                    clickable: true
                });
            },
		onEachFeature: function (feature, layer) //functionality on click on feature
			{
				
			layer.bindPopup("Name: " + feature.properties.CENTRE_NAM + '</b><br>' + "Address: " + feature.properties.ADDRESS + '</b><br>' + "Postcode: " + feature.properties.POSTCODE + '</b><br>' + "School Type: " + feature.properties.SCHOOL_TYP); //School information
			}
		});
		
	
	function getColour(d) {
		switch (d) {
			case 'playgroup not in a school': return 'brown';
			case 'playgroup in a school': return 'orange';
			case 'day nursery': return 'yellow';
			case 'prep dept': return 'black';
			case 'Nursery': return 'green';
			case 'Primary': return 'red';
			case 'Secondary': return 'blue';
			case 'Grammar': return 'purple';
			case 'Special Schools': return 'pink';
			default: return 'grey';
		}
	};
	
	markers.addLayer(points_rand); // add it to the cluster group
	map.addLayer(markers);		// add it to the map
	map.setView([54.655078, -6.969706], 9);
	
	var searchControl = new L.Control.Search({
		layer: markers,
		propertyName: 'CENTRE_NAM',
		circleLocation: true,
		moveToLocation: function(latlng, title, map) {
			//map.fitBounds( latlng.layer.getBounds() );
			var zoom = map.getBoundsZoom(latlng.layer.getBounds());
  			map.setView(latlng, zoom); // access the zoom
		}
		});
	
	searchControl.on('search_locationfound', function(e) {
		on('search_collapsed', function(e) {
			markers.resetStyle(layer);
	})
	});
			
	map.addControl( searchControl );  //inizialize search control
	
		
	var legend = L.control({position: 'bottomright'});
	legend.onAdd = function (map) {
		var div = L.DomUtil.create('div', 'info legend');
			schoolstatus = ['playgroup not in a school', 'playgroup in a school', 'day nursery', 'Nursery', 'Primary', 'Secondary', 'Grammar', 'Special Schools', 'prep dept'];
		// loop through the schoolstatus and generate a label with a coloured square for each value
		for (var i = 0; i < schoolstatus.length; i++) {
			div.innerHTML += '<i class="circle" style="background:' + getColour(schoolstatus[i]) + '"></i> ' + (schoolstatus[i] ? schoolstatus[i] + '<br>' : '+');
		}
		return div;
	};
	
	legend.addTo(map);
	
	

  </script>
 </body>
</html>


